/**
 * BitChat In Browser - Responsive Design System
 *
 * Mobile-first responsive styles with:
 * - Safe area insets (notch, home indicator)
 * - Landscape orientation support
 * - Tablet layout optimization
 * - Touch-optimized interactions
 */

/* ==========================================================================
   CSS Custom Properties for Responsive Design
   ========================================================================== */

:root {
  /* Breakpoint values for reference (match Tailwind defaults) */
  --breakpoint-sm: 640px;
  --breakpoint-md: 768px;
  --breakpoint-lg: 1024px;
  --breakpoint-xl: 1280px;
  --breakpoint-2xl: 1536px;

  /* Safe area insets with fallbacks */
  --safe-area-inset-top: env(safe-area-inset-top, 0px);
  --safe-area-inset-right: env(safe-area-inset-right, 0px);
  --safe-area-inset-bottom: env(safe-area-inset-bottom, 0px);
  --safe-area-inset-left: env(safe-area-inset-left, 0px);

  /* Navigation heights */
  --nav-height-mobile: 3.5rem;
  --nav-height-desktop: 3.5rem;
  --header-height: 3.5rem;
  --status-bar-height: 1.75rem;
  --status-bar-height-compact: 1.25rem;

  /* Sidebar widths */
  --sidebar-width: 280px;
  --sidebar-width-collapsed: 64px;
  --sidebar-width-xl: 320px;

  /* Content constraints */
  --content-max-width: 768px;
  --chat-max-width: 900px;

  /* Touch targets */
  --touch-target-min: 44px;
  --touch-target-comfortable: 48px;

  /* Spacing for different screen sizes */
  --spacing-mobile: 0.75rem;
  --spacing-tablet: 1rem;
  --spacing-desktop: 1.5rem;
}

/* ==========================================================================
   Safe Area Utilities
   ========================================================================== */

/* Padding utilities with safe area awareness */
.safe-area-top {
  padding-top: var(--safe-area-inset-top);
}

.safe-area-right {
  padding-right: var(--safe-area-inset-right);
}

.safe-area-bottom {
  padding-bottom: var(--safe-area-inset-bottom);
}

.safe-area-left {
  padding-left: var(--safe-area-inset-left);
}

.safe-area-x {
  padding-left: var(--safe-area-inset-left);
  padding-right: var(--safe-area-inset-right);
}

.safe-area-y {
  padding-top: var(--safe-area-inset-top);
  padding-bottom: var(--safe-area-inset-bottom);
}

.safe-area-all {
  padding-top: var(--safe-area-inset-top);
  padding-right: var(--safe-area-inset-right);
  padding-bottom: var(--safe-area-inset-bottom);
  padding-left: var(--safe-area-inset-left);
}

/* Margin utilities with safe area */
.safe-margin-top {
  margin-top: var(--safe-area-inset-top);
}

.safe-margin-bottom {
  margin-bottom: var(--safe-area-inset-bottom);
}

/* Min-height with safe area consideration */
.min-h-safe {
  min-height: calc(100vh - var(--safe-area-inset-top) - var(--safe-area-inset-bottom));
  min-height: calc(100dvh - var(--safe-area-inset-top) - var(--safe-area-inset-bottom));
}

/* ==========================================================================
   Mobile First Base Styles
   ========================================================================== */

/* Root element responsive behavior */
.app-root {
  min-height: 100vh;
  min-height: 100dvh;
  display: flex;
  flex-direction: column;
  overflow-x: hidden;
}

/* Main content area with proper scrolling */
.main-content {
  flex: 1;
  overflow-y: auto;
  overflow-x: hidden;
  -webkit-overflow-scrolling: touch;
  overscroll-behavior-y: contain;
}

/* Navigation container - bottom on mobile */
.nav-container {
  position: fixed;
  left: 0;
  right: 0;
  bottom: 0;
  z-index: 50;
  padding-bottom: var(--safe-area-inset-bottom);
  background: var(--color-background, #0a0a0a);
  border-top: 1px solid rgba(0, 255, 0, 0.3);
}

/* Header with safe area */
.app-header {
  position: sticky;
  top: 0;
  z-index: 40;
  padding-top: var(--safe-area-inset-top);
  background: var(--color-background, #0a0a0a);
  border-bottom: 1px solid rgba(0, 255, 0, 0.3);
}

/* ==========================================================================
   Mobile Styles (< 640px)
   ========================================================================== */

/* Touch-optimized buttons */
.touch-target {
  min-height: var(--touch-target-min);
  min-width: var(--touch-target-min);
}

/* Mobile message input - sticky bottom */
.message-input-container {
  position: sticky;
  bottom: 0;
  left: 0;
  right: 0;
  z-index: 30;
  padding-bottom: var(--safe-area-inset-bottom);
  background: var(--color-background, #0a0a0a);
}

/* Mobile chat view - full screen */
.chat-view-mobile {
  position: fixed;
  inset: 0;
  z-index: 60;
  display: flex;
  flex-direction: column;
  background: var(--color-background, #0a0a0a);
  padding-top: var(--safe-area-inset-top);
}

/* Mobile modal - full screen */
.modal-mobile {
  position: fixed;
  inset: 0;
  z-index: 100;
  padding-top: var(--safe-area-inset-top);
  padding-bottom: var(--safe-area-inset-bottom);
  padding-left: var(--safe-area-inset-left);
  padding-right: var(--safe-area-inset-right);
  background: var(--color-background, #0a0a0a);
}

/* Mobile list items - touch friendly */
.list-item-touch {
  min-height: var(--touch-target-comfortable);
  padding: 0.75rem 1rem;
  display: flex;
  align-items: center;
  gap: 0.75rem;
  -webkit-tap-highlight-color: rgba(0, 255, 0, 0.1);
  transition: background-color 0.15s ease;
}

.list-item-touch:active {
  background-color: rgba(0, 255, 0, 0.05);
}

/* ==========================================================================
   Tablet Styles (768px - 1023px)
   ========================================================================== */

@media (min-width: 768px) {
  :root {
    --spacing-current: var(--spacing-tablet);
  }

  /* Tablet navigation - can be either bottom or sidebar */
  .nav-container-tablet-bottom {
    position: fixed;
    left: 0;
    right: 0;
    bottom: 0;
    padding-bottom: var(--safe-area-inset-bottom);
  }

  .nav-container-tablet-sidebar {
    position: fixed;
    left: 0;
    top: 0;
    bottom: 0;
    width: var(--sidebar-width-collapsed);
    padding-top: var(--safe-area-inset-top);
    padding-bottom: var(--safe-area-inset-bottom);
    border-right: 1px solid rgba(0, 255, 0, 0.3);
    border-top: none;
  }

  /* Tablet modal - centered overlay */
  .modal-tablet {
    position: fixed;
    inset: 0;
    z-index: 100;
    display: flex;
    align-items: center;
    justify-content: center;
    padding: 2rem;
    background: rgba(0, 0, 0, 0.8);
  }

  .modal-tablet-content {
    max-width: 500px;
    max-height: 80vh;
    width: 100%;
    border-radius: 4px;
    overflow: hidden;
    background: var(--color-background, #0a0a0a);
    border: 1px solid rgba(0, 255, 0, 0.3);
  }

  /* Tablet split view */
  .split-view-tablet {
    display: grid;
    grid-template-columns: var(--sidebar-width) 1fr;
    height: 100vh;
    height: 100dvh;
  }

  /* Chat view constraints */
  .chat-view-tablet {
    max-width: var(--chat-max-width);
    margin: 0 auto;
  }
}

/* ==========================================================================
   Desktop Styles (1024px+)
   ========================================================================== */

@media (min-width: 1024px) {
  :root {
    --spacing-current: var(--spacing-desktop);
  }

  /* Desktop navigation - sidebar */
  .nav-container {
    position: fixed;
    left: 0;
    top: 0;
    bottom: 0;
    width: var(--sidebar-width);
    border-right: 1px solid rgba(0, 255, 0, 0.3);
    border-top: none;
    padding-top: var(--safe-area-inset-top);
    padding-bottom: var(--safe-area-inset-bottom);
  }

  /* Main content with sidebar offset */
  .main-content-with-sidebar {
    margin-left: var(--sidebar-width);
    padding-top: var(--safe-area-inset-top);
  }

  /* Desktop modal - centered with max width */
  .modal-desktop {
    position: fixed;
    inset: 0;
    z-index: 100;
    display: flex;
    align-items: center;
    justify-content: center;
    padding: 2rem;
    background: rgba(0, 0, 0, 0.8);
  }

  .modal-desktop-content {
    max-width: 600px;
    max-height: 85vh;
    width: 100%;
    border-radius: 4px;
    overflow: hidden;
    background: var(--color-background, #0a0a0a);
    border: 1px solid rgba(0, 255, 0, 0.3);
  }

  /* Desktop three-column layout */
  .layout-three-column {
    display: grid;
    grid-template-columns: var(--sidebar-width) 320px 1fr;
    height: 100vh;
    height: 100dvh;
  }

  /* Chat view on desktop */
  .chat-view-desktop {
    display: flex;
    flex-direction: column;
    height: 100%;
  }

  /* Message input not sticky on desktop - flows naturally */
  .message-input-desktop {
    position: relative;
    bottom: auto;
    padding-bottom: 1rem;
  }
}

/* ==========================================================================
   Extra Large Desktop (1280px+)
   ========================================================================== */

@media (min-width: 1280px) {
  .nav-container {
    width: var(--sidebar-width-xl);
  }

  .main-content-with-sidebar {
    margin-left: var(--sidebar-width-xl);
  }

  .layout-three-column {
    grid-template-columns: var(--sidebar-width-xl) 360px 1fr;
  }
}

/* ==========================================================================
   Landscape Orientation Support
   ========================================================================== */

@media (orientation: landscape) {
  /* Compact navigation in landscape */
  .nav-landscape-compact .nav-container {
    height: auto;
  }

  /* Horizontal safe areas in landscape */
  .landscape-safe-x {
    padding-left: max(var(--safe-area-inset-left), 1rem);
    padding-right: max(var(--safe-area-inset-right), 1rem);
  }
}

/* Landscape on mobile - special handling */
@media (orientation: landscape) and (max-height: 500px) {
  /* Reduce header height in cramped landscape */
  .app-header {
    padding-top: 0;
    padding-bottom: 0;
  }

  .app-header h1 {
    font-size: 0.875rem;
  }

  /* Minimize navigation in landscape mobile */
  .nav-container {
    padding-top: 0.25rem;
    padding-bottom: max(var(--safe-area-inset-bottom), 0.25rem);
  }

  /* Stack items horizontally in cramped landscape */
  .nav-items-landscape {
    flex-direction: row;
    justify-content: space-around;
    padding: 0.5rem 0;
  }

  /* Reduce message input height */
  .message-input-landscape textarea {
    max-height: 60px;
  }

  /* Hide non-essential elements */
  .hide-landscape-mobile {
    display: none !important;
  }
}

/* Landscape on tablet - split view */
@media (orientation: landscape) and (min-width: 768px) and (max-width: 1023px) {
  .split-view-landscape {
    display: grid;
    grid-template-columns: 300px 1fr;
    height: 100vh;
    height: 100dvh;
  }

  .split-view-landscape .sidebar {
    border-right: 1px solid rgba(0, 255, 0, 0.3);
    overflow-y: auto;
  }
}

/* ==========================================================================
   Touch Interaction Styles
   ========================================================================== */

/* Swipe gesture hints */
.swipe-indicator {
  position: absolute;
  left: 0;
  top: 50%;
  transform: translateY(-50%);
  width: 4px;
  height: 40px;
  background: rgba(0, 255, 0, 0.3);
  border-radius: 0 2px 2px 0;
  opacity: 0;
  transition: opacity 0.2s ease;
}

.can-swipe-back .swipe-indicator {
  opacity: 1;
}

/* Pull to refresh indicator */
.pull-to-refresh {
  position: absolute;
  top: 0;
  left: 0;
  right: 0;
  display: flex;
  align-items: center;
  justify-content: center;
  height: 60px;
  transform: translateY(-100%);
  transition: transform 0.2s ease;
  background: var(--color-background, #0a0a0a);
  z-index: 10;
}

.pull-to-refresh.visible {
  transform: translateY(0);
}

.pull-to-refresh-spinner {
  width: 24px;
  height: 24px;
  border: 2px solid rgba(0, 255, 0, 0.3);
  border-top-color: #00ff00;
  border-radius: 50%;
  animation: spin 0.8s linear infinite;
}

@keyframes spin {
  from {
    transform: rotate(0deg);
  }
  to {
    transform: rotate(360deg);
  }
}

/* Long press highlight */
.long-press-target {
  transition: background-color 0.15s ease, transform 0.15s ease;
}

.long-press-target.pressing {
  background-color: rgba(0, 255, 0, 0.1);
  transform: scale(0.98);
}

/* Context menu */
.context-menu {
  position: fixed;
  z-index: 200;
  min-width: 160px;
  background: var(--color-surface, #1a1a1a);
  border: 1px solid rgba(0, 255, 0, 0.3);
  border-radius: 4px;
  box-shadow: 0 4px 12px rgba(0, 0, 0, 0.5);
  overflow: hidden;
  animation: context-menu-in 0.15s ease;
}

@keyframes context-menu-in {
  from {
    opacity: 0;
    transform: scale(0.95);
  }
  to {
    opacity: 1;
    transform: scale(1);
  }
}

.context-menu-item {
  display: flex;
  align-items: center;
  gap: 0.75rem;
  padding: 0.75rem 1rem;
  font-size: 0.875rem;
  color: #e0e0e0;
  transition: background-color 0.15s ease;
  cursor: pointer;
}

.context-menu-item:hover,
.context-menu-item:focus {
  background-color: rgba(0, 255, 0, 0.1);
  outline: none;
}

.context-menu-item:active {
  background-color: rgba(0, 255, 0, 0.2);
}

.context-menu-divider {
  height: 1px;
  background: rgba(0, 255, 0, 0.2);
  margin: 0.25rem 0;
}

/* ==========================================================================
   Responsive Typography
   ========================================================================== */

/* Fluid typography for different screens */
.text-responsive-sm {
  font-size: clamp(0.75rem, 2vw, 0.8125rem);
}

.text-responsive-base {
  font-size: clamp(0.8125rem, 2.5vw, 0.875rem);
}

.text-responsive-lg {
  font-size: clamp(0.875rem, 3vw, 1rem);
}

.text-responsive-xl {
  font-size: clamp(1rem, 3.5vw, 1.125rem);
}

/* ==========================================================================
   Responsive Spacing
   ========================================================================== */

.p-responsive {
  padding: var(--spacing-mobile);
}

.px-responsive {
  padding-left: var(--spacing-mobile);
  padding-right: var(--spacing-mobile);
}

.py-responsive {
  padding-top: var(--spacing-mobile);
  padding-bottom: var(--spacing-mobile);
}

.gap-responsive {
  gap: var(--spacing-mobile);
}

@media (min-width: 768px) {
  .p-responsive {
    padding: var(--spacing-tablet);
  }

  .px-responsive {
    padding-left: var(--spacing-tablet);
    padding-right: var(--spacing-tablet);
  }

  .py-responsive {
    padding-top: var(--spacing-tablet);
    padding-bottom: var(--spacing-tablet);
  }

  .gap-responsive {
    gap: var(--spacing-tablet);
  }
}

@media (min-width: 1024px) {
  .p-responsive {
    padding: var(--spacing-desktop);
  }

  .px-responsive {
    padding-left: var(--spacing-desktop);
    padding-right: var(--spacing-desktop);
  }

  .py-responsive {
    padding-top: var(--spacing-desktop);
    padding-bottom: var(--spacing-desktop);
  }

  .gap-responsive {
    gap: var(--spacing-desktop);
  }
}

/* ==========================================================================
   Device-Specific Fixes
   ========================================================================== */

/* iOS Safari - fix 100vh issue */
@supports (-webkit-touch-callout: none) {
  .h-screen-ios {
    height: -webkit-fill-available;
  }

  .min-h-screen-ios {
    min-height: -webkit-fill-available;
  }
}

/* Prevent iOS bounce when at bottom */
.ios-no-bounce {
  position: fixed;
  width: 100%;
  overflow: hidden;
}

/* iOS input zoom prevention */
@media screen and (-webkit-min-device-pixel-ratio: 0) {
  select:focus,
  textarea:focus,
  input:focus {
    font-size: 16px;
  }
}

/* Android keyboard adjustment */
.keyboard-open .message-input-container {
  position: relative;
  bottom: auto;
}

/* ==========================================================================
   Print Styles
   ========================================================================== */

@media print {
  .nav-container,
  .app-header,
  .message-input-container {
    display: none !important;
  }

  .main-content {
    margin: 0 !important;
    padding: 0 !important;
  }
}
